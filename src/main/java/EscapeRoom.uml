@startuml
' Set direction
left to right direction

' --- Enums ---
enum Difficulty {
    EASY
    MEDIUM
    HARD
}
enum Material {
    WOOD
    METAL
    PLASTIC
    TEXTILE
}
enum ClueType {
    TEXT
    PUZZLE
    VISUAL
}
enum AchievementType {
    FIRST_TIME_SOLVER
    SPEED_RUN
    ALL_CLUES_FOUND
}

' --- Inventory Interfaces and Base Classes ---
interface InventoryItem {
    + getName(): String
    + getPrice(): Double
    + getDescription(): String
    + calculatePrice(): Double
}

interface Observer {
    + getPlayerId(): String
    + update(message: String): void
}

interface Subject {
    + registerObserver(o: Observer): void
    + removeObserver(o: Observer): void
    + notifyObservers(event: String): void
}

abstract class Decoration {
    -ID: id
    - name: String
    - price: double
    - material: Material
    - description: String
    - quantity: int
}
abstract class Clue {
    -id: ID
    - name: String
    - price: double
    - type: ClueType
    - theme: String
    - revealed: boolean
}
abstract class Reward {
    -id:ID
    - name: String
    - price: double
    - description: String
    - stock: int
}

InventoryItem <|.. Decoration
InventoryItem <|.. Clue
InventoryItem <|.. Reward

' --- Room Class ---
abstract class Room {
    -id:ID
    - name: String
    - difficulty: Difficulty
    - InventoryItem: List<InventoryItem>
    + getPrice(): double
}

Room "1" *-- "0..*" InventoryItem : contains
Room ..> Difficulty
Decoration ..> Material
Clue ..> ClueType

' --- Player, Achievements, Ticket ---
class Player {
    - name: String
    - id: String
    - subscribed: boolean
    - achievements: List<Certificate>
    - rewards: List<InventoryItem>
    + addAchievement(cert: Certificate): void
    + addReward(inventoryItem: InventoryItem): void
    + update(message: String): void
}
class Certificate {
    -id:ID
    - playerName: String
    - achievementType: AchievementType
    - obtainedTime: LocalDateTime
    - roomName: String
}
class Ticket {
    -id:ID
    - ticketId: long
    - playerName: String
    - price: Double
    - purchaseTime: LocalDateTime
}

Observer <|.. Player
Player "1" -- "0..*" Reward : owns >
Player "1" -- "0..*" Certificate : obtains >

' --- Application Services ---
class InventoryService {
    - inventoryItems: List<InventoryItem>
    + getInventoryQuantities()
    + getTotalInventoryValue()
    + removeItem()
}

class EscapeRoomManagementService {
    - builder: EscapeRoomBuilder
    + createEscapeRoom() --> EscapeRoom
    + addRoom()
    + addInventoryItemToRoom(DAO dao)

}

class TicketService {
    - soldTickets: List<Ticket>
    + sellTicket(player: Player, price: double): Ticket
    + getTotalRevenue(): double
}

class PlayerService {
    - players: List<Player>
    + registerPlayer(name: String): Player
    + getPlayer(id: String): Player
    + evaluateAndGrantAchievement(player: Player, room: Room): Optional<Certificate>
    + grantReward(player: Player, reward: Reward): void
    + getPlayerProgress(playerId: String): String
    + listAllPlayers(): List<Player>
}

class NotificationService {
    - observers: List<Observer>
    + notifyObservers(event: String): void
    + notifyRoomCompletion(playerName: String, roomName: String): void
}
Subject <|.. NotificationService
NotificationService "1" -- "0..*" Observer : notifies >

' --- Game Session Coordinator ---
class GameSessionService {
    - management: EscapeRoomManagementService
    - inventory: InventoryService
    - ticket: TicketService
    - notification: NotificationService
    + start(): void
    + sellTicket(player: Player, price: double): Ticket
    + playRoom(player: Player, room: Room): Certificate
    + createRoom(name: String, difficulty: Difficulty): void
}

class EscapeRoomController {
    - gameSessionService: GameSessionService
    + startGame(): void
}

EscapeRoomController --> GameSessionService : calls
GameSessionService ..> EscapeRoomManagementService : coordinates
GameSessionService ..> InventoryService : coordinates
GameSessionService ..> TicketService : coordinates
GameSessionService ..> NotificationService : coordinates
TicketService "1" *-- "0..*" Ticket : manages >
Player "1" <-- "0..*" Ticket : buys >
EscapeRoomManagementService "1" *-- "0..*" Room : manages >
GameSessionService ..> Room : plays >
GameSessionService ..> Player : plays >
GameSessionService --> PlayerService : uses
PlayerService "1" --> "0..*" Player : manages
PlayerService ..> Certificate : generates
PlayerService ..> Reward : grants

' --- ESCAPE ROOM BUILDER PATTERN ---
class EscapeRoom {
    - name: String
    - rooms: List<Room>
    + calculateTotalPrice(): Double
}

interface EscapeRoomBuilder {
    + setName(name: String): EscapeRoomBuilder
    + addRoom(room: Room): EscapeRoomBuilder
    + addInventoryItem(InventoryItem: inventoryItem): EscapeRoomBuilder
    + build(): EscapeRoom
}

abstract class StandardEscapeRoomBuilder implements EscapeRoomBuilder

class EscapeRoomDirector {
    - builder: EscapeRoomBuilder
    + setBuilder(builder: EscapeRoomBuilder): void
    + constructStandardRoom(): EscapeRoom
}

EscapeRoomManagementService --> EscapeRoomBuilder
EscapeRoomBuilder --> EscapeRoom
EscapeRoom *-- "0..*" Room : contains
EscapeRoomDirector --> EscapeRoomBuilder : uses
EscapeRoomBuilder --> EscapeRoom : builds
Certificate ..> AchievementType : has >

@enduml