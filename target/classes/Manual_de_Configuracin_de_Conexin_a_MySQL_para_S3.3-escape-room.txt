âš™ï¸ S3.3-Escape-Room é¡¹ç›® MySQL è¿æ¥é…ç½®æ‰‹å†Œï¼ˆä¸­æ–‡ç¿»è¯‘ï¼‰
Esto permite que el mismo cÃ³digo Java funcione sin modificaciones en cualquier entorno.
è¿™ä½¿å¾—åŒä¸€ä»½ Java ä»£ç æ— éœ€ä¿®æ”¹å³å¯åœ¨ä»»ä½•ç¯å¢ƒä¸­è¿è¡Œã€‚
ç¯å¢ƒä¹‹é—´çš„å·®å¼‚é€šè¿‡æ³¨å…¥å˜é‡ DB_URL æ¥ç®¡ç†ã€‚
________________________________________
2.1. Docker ç¯å¢ƒï¼ˆç”Ÿäº§ / å®¹å™¨ï¼‰ğŸ³
åº”ç”¨ç¨‹åºåœ¨ Docker ç½‘ç»œ app_network å†…è¿è¡Œã€‚
A. Maven é…ç½®
pom.xml å¿…é¡»ä½¿ç”¨ maven-shade-plugin æ¥ç”Ÿæˆ Uber JARï¼ˆåŒ…å« JDBC é©±åŠ¨ï¼‰ã€‚
è¿™æ ·å¯ä»¥é¿å…å‡ºç°ï¼š
No suitable driver found
çš„é”™è¯¯ã€‚
________________________________________
B. docker-compose.yaml æˆ– .env ä¸­çš„å…³é”®å˜é‡
å˜é‡	è¦æ±‚çš„å€¼	ç›®çš„
DB_URL	jdbc:mysql://db:3306/${DB_DATABASE}?autoReconnect=true&useSSL=false&allowPublicKeyRetrieval=true	ä½¿ç”¨ Docker å†…éƒ¨çš„ hostname db å’Œé»˜è®¤ç«¯å£ 3306ã€‚allowPublicKeyRetrieval=true å¯¹ MySQL 8 è‡³å…³é‡è¦ã€‚
commandï¼š
sh -c "sleep 10 && java -jar /app/app.jar"
åŠ å…¥ 10 ç§’æš‚åœï¼Œé˜²æ­¢ MySQL å°šæœªå®Œå…¨å¯åŠ¨æ—¶ Java æå‰è¿æ¥è€Œå¯¼è‡´ï¼š
Connection refused
________________________________________
2.2. æœ¬åœ°ç¯å¢ƒï¼ˆIntelliJï¼‰ğŸ’»
åº”ç”¨ç¨‹åºç›´æ¥åœ¨æ“ä½œç³»ç»Ÿä¸­è¿è¡Œï¼Œå¹¶è¿æ¥æ˜ å°„åˆ°ä¸»æœºçš„ MySQL ç«¯å£ã€‚
A. è¿è¡Œé…ç½®
éœ€è¦åœ¨ IntelliJ çš„ Run Configuration ä¸­æ‰‹åŠ¨è®¾ç½®ç¯å¢ƒå˜é‡ã€‚
å˜é‡	æœ¬åœ°è¿è¡Œçš„å€¼	åŸå› 
DB_URL	jdbc:mysql://localhost:3307/escape_room_db?autoReconnect=true&useSSL=false&allowPublicKeyRetrieval=true	ä½¿ç”¨ localhostï¼Œå¹¶é€šè¿‡ 3307ï¼ˆä»å®¹å™¨æ˜ å°„å‡ºæ¥çš„ç«¯å£ï¼‰è¿æ¥
DB_USER	ï¼ˆå–è‡ª .envï¼‰	MySQL ç”¨æˆ·å
DB_PASSWORD	ï¼ˆå–è‡ª .envï¼‰	MySQL å¯†ç 
________________________________________
B. æœ¬åœ°è¿è¡Œæ­¥éª¤
1.	ç¡®ä¿ MySQL å®¹å™¨æ­£åœ¨è¿è¡Œï¼š
docker compose up -d
2.	åœ¨ IntelliJ ä¸­è¿è¡Œä½ çš„ Main ç±»ï¼ˆç‚¹å‡» â€œRunâ€ æŒ‰é’®ï¼‰ã€‚
________________________________________
3. å¸¸è§é”™è¯¯å¿«é€Ÿè§£å†³æŒ‡å—
æ—¥å¿—ä¸­çš„é”™è¯¯	æ ¹æœ¬åŸå› 	è§£å†³æ–¹æ¡ˆ
UnknownHostException: db	åœ¨ IntelliJ ä¸­è¿è¡Œï¼Œä½†ä½¿ç”¨äº† Docker çš„ URLï¼ˆdbï¼‰	å°†æœ¬åœ°çš„ DB_URL ä¿®æ”¹ä¸º localhost:3307
No suitable driver found	MySQL é©±åŠ¨æœªè¢«æ‰“åŒ…è¿› JAR	ä½¿ç”¨ maven-shade-plugin é‡æ–°ç”Ÿæˆ Uber JARï¼šmvn clean package
Connection refused	Java ç¨‹åºå¯åŠ¨æ—©äº MySQL å®Œå…¨å¯åŠ¨	åœ¨ docker-compose çš„ app æœåŠ¡ä¸­åŠ å…¥ sleep 10
Public Key Retrieval is not allowed	MySQL 8 çš„è®¤è¯è¦æ±‚	åœ¨è¿æ¥ä¸²æœ«å°¾åŠ å…¥ï¼š&allowPublicKeyRetrieval=true
Esto permite que el mismo cÃ³digo Java funcione sin modificaciones en cualquier entorno. La diferencia entre entornos se gestiona mediante la inyecciÃ³n de la variable DB_URL . 2.1. Entorno Docker (ProducciÃ³n/Contenedor) ğŸ³ La aplicaciÃ³n se ejecuta dentro de la red Docker ( app_network ). A. ConfiguraciÃ³n de Maven El archivo pom.xml debe usar el maven-shade-plugin para generar un Uber JAR (que incluye el driver JDBC) y evitar el error No suitable driver found . B. Variables Clave en docker-compose.yaml o .env Variable Valor Requerido PropÃ³sito DB_URL jdbc:mysql://db:3306/${DB_DATABASE}?autoReconnect=true&useSSL=false&allowPublicKeyRetrieval=true Utiliza el hostnameinterno ( db ) y el puertopor defecto ( 3306 ). allowPublicKeyRetrieval=true es esencial para MySQL8.âš™ï¸ Manual de ConfiguraciÃ³n de ConexiÃ³n a MySQL para S3.3-Escape-Room 1 command sh -c "sleep 10 && java -jar /app/app.jar" Resuelve el error Connection refused alaÃ±adir una pausa de 10segundos para darletiempo a MySQL deinicializarsecompletamente. 2.2. Entorno Local (IntelliJ) ğŸ’» La aplicaciÃ³n se ejecuta directamente en el sistema operativo y accede al puerto mapeado del contenedor MySQL. A. ConfiguraciÃ³n de EjecuciÃ³n Debes configurar las variables de entorno manualmente en la Run Configuration de la clase Main en IntelliJ. Variable Valor Ajustado para Local RazÃ³n DB_URL jdbc:mysql://localhost:3307/escape_room_db?autoReconnect=true&useSSL=false&allowPublicKeyRetrieval=true Utiliza localhost y elpuerto mapeado 3307 (el puerto queel contenedor exponea tu mÃ¡quina). DB_USER ( Valor de su .env ) Credenciales DB_PASSWORD ( Valor de su .env ) Credenciales B. Procedimiento de EjecuciÃ³n1. AsegÃºrate de que el contenedor MySQL estÃ© activo: docker compose up -d2. Ejecutar la clase Main desde IntelliJ (botÃ³n "Run"). 3. GuÃ­a RÃ¡pida de SoluciÃ³n de Errores Error en los Logs Causa Principal SoluciÃ³n UnknownHostException:db Se estÃ¡ ejecutando enIntelliJ, pero se usa la URL deDocker ( db ). Corregir DB_URL en IntelliJ a localhost:3307 . No suitable driver found El conector MySQL no estÃ¡en el JAR. Regenerar el Uber JAR ( mvn clean package )asegurando que se use el maven-shade-plugin .âš™ï¸ Manual de ConfiguraciÃ³n de ConexiÃ³n a MySQL para S3.3-Escape-Room 2 Connection refused La aplicaciÃ³n Java se iniciÃ³antes que MySQL. AÃ±adir o verificar el sleep 10 en el command del servicio app en docker-compose.yaml . Public Key Retrieval is notallowed Falla de autenticaciÃ³n porprotocolo de MySQL 8. AÃ±adir &allowPublicKeyRetrieval=true al finalde la DB_URL
